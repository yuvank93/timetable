<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>College Timetable Generator</title>
    <style>
        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #ec4899;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark-1: #0f172a;
            --dark-2: #1e293b;
            --dark-3: #334155;
            --light-1: #f1f5f9;
            --light-2: #e2e8f0;
            --glass-bg: rgba(30, 41, 59, 0.7);
            --glass-border: rgba(255, 255, 255, 0.1);
            --glass-shadow: 0 8px 32px 0 rgba(0, 0, 0, 0.36);
            --border-radius: 16px;
            --transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', sans-serif;
            line-height: 1.6;
            color: var(--light-1);
            background: linear-gradient(135deg, #0f172a 0%, #1e1b4b 100%);
            min-height: 100vh;
            padding: 2rem;
            background-attachment: fixed;
        }

        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: 
                radial-gradient(circle at 10% 20%, rgba(99, 102, 241, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 90% 80%, rgba(139, 92, 246, 0.1) 0%, transparent 20%),
                radial-gradient(circle at 50% 50%, rgba(236, 72, 153, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: -1;
        }

        h1 {
            font-size: 2.5rem;
            background: linear-gradient(90deg, #fff, #a5b4fc);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin: 1.5rem 0 2.5rem;
            position: relative;
            font-weight: 800;
            letter-spacing: -0.025em;
        }

        h1::after {
            content: '';
            position: absolute;
            bottom: -12px;
            left: 50%;
            transform: translateX(-50%);
            width: 100px;
            height: 4px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        .form-section {
            background: var(--glass-bg);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            border-radius: var(--border-radius);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--glass-shadow);
            transition: var(--transition);
        }

        .form-section:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
        }

        .form-section h2 {
            font-size: 1.5rem;
            color: var(--light-1);
            margin: 0 0 1.5rem;
            padding-bottom: 0.75rem;
            border-bottom: 2px solid var(--primary);
            position: relative;
        }

        .form-section h2::after {
            content: '';
            position: absolute;
            bottom: -2px;
            left: 0;
            width: 60px;
            height: 3px;
            background: linear-gradient(90deg, var(--primary), var(--secondary));
            border-radius: 2px;
        }

        .form-group {
            margin-bottom: 1.25rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--light-2);
            font-size: 0.95rem;
        }

        input[type="time"],
        input[type="number"],
        input[type="text"],
        select {
            padding: 0.75rem 1rem;
            background: rgba(15, 23, 42, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-size: 0.95rem;
            color: var(--light-1);
            transition: var(--transition);
            width: 100%;
            max-width: 300px;
        }

        input[type="time"]:focus,
        input[type="number"]:focus,
        input[type="text"]:focus,
        select:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 2px rgba(99, 102, 241, 0.3);
        }

        .break-row, 
        .subject-row, 
        .teacher-row {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            align-items: center;
            padding: 1.25rem;
            background: rgba(30, 41, 59, 0.5);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            transition: var(--transition);
            flex-wrap: wrap;
        }

        .break-row:hover,
        .subject-row:hover,
        .teacher-row:hover {
            background: rgba(30, 41, 59, 0.7);
            transform: translateX(4px);
        }

        .break-row input, 
        .subject-row input, 
        .teacher-row input,
        .break-row select, 
        .subject-row select, 
        .teacher-row select {
            padding: 0.75rem 1rem;
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            background: rgba(15, 23, 42, 0.7);
            color: var(--light-1);
            transition: var(--transition);
            flex: 1;
            min-width: 120px;
        }

        .subject-row input[type="text"], 
        .teacher-row input[type="text"] {
            min-width: 180px;
        }

        .subject-row .class-type {
            min-width: 140px;
        }

        .subject-row .credits-input {
            width: 90px;
        }

        .subject-row .priority-select {
            min-width: 140px;
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 10px;
            font-weight: 500;
            cursor: pointer;
            transition: var(--transition);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.2);
        }

        .btn:active {
            transform: translateY(0);
        }

        .btn-remove {
            background: linear-gradient(135deg, var(--danger), #f87171);
        }

        .btn-add {
            background: linear-gradient(135deg, var(--success), #34d399);
            margin-top: 1rem;
        }

        #generate-timetable {
            padding: 1rem 2rem;
            font-size: 1.1rem;
            font-weight: 600;
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: white;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            margin: 1.5rem 0 2rem;
            transition: var(--transition);
            display: block;
            width: 100%;
            max-width: 300px;
            margin-left: auto;
            margin-right: auto;
        }

        #generate-timetable:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(99, 102, 241, 0.4);
        }

        #loading {
            text-align: center;
            padding: 2rem;
            color: var(--light-1);
            font-size: 1.1rem;
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            margin: 2rem 0;
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
        }

        .error {
            color: #fecaca;
            background: rgba(220, 38, 38, 0.2);
            padding: 1.25rem;
            border-radius: var(--border-radius);
            margin: 1.5rem 0;
            display: none;
            border-left: 4px solid var(--danger);
            backdrop-filter: blur(8px);
        }

        #timetable {
            margin-top: 2rem;
            background: var(--glass-bg);
            border-radius: var(--border-radius);
            padding: 2rem;
            backdrop-filter: blur(12px);
            border: 1px solid var(--glass-border);
            box-shadow: var(--glass-shadow);
        }

        /* Scrollbar Styling */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--primary);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--primary-dark);
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            body {
                padding: 1.5rem;
            }
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            h1 {
                font-size: 2rem;
                margin-bottom: 1.5rem;
            }

            .form-section {
                padding: 1.5rem;
            }

            .break-row,
            .subject-row,
            .teacher-row {
                flex-direction: column;
                align-items: stretch;
                gap: 0.75rem;
            }

            .btn {
                width: 100%;
                margin-top: 0.5rem;
            }

            #generate-timetable {
                max-width: 100%;
            }
        }

        @media (max-width: 480px) {
            body {
                padding: 1rem 0.75rem;
            }

            h1 {
                font-size: 1.75rem;
            }

            .form-section {
                padding: 1.25rem;
            }
        }
        #generate-timetable:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #timetable {
            margin-top: 20px;
        }
        .error {
            color: #d32f2f;
            margin-top: 10px;
        }
        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
        }
        th, td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        th {
            background-color: #f2f2f2;
            color: #000000;        
        }
    </style>
</head>
<body>
    <h1>College Timetable Generator</h1>
    
    <form id="timetableForm">
        <div class="form-section">
            <h2>College Information</h2>
            <div class="form-group">
                <label>Course Name: <input type="text" id="courseName" value="BTech" required></label>
                <label>Branch: <input type="text" id="branchName" value="CSE" required></label>
            </div>
            <div class="form-group">
                <label>College Start Time: <input type="time" id="startTime" value="09:00" required></label>
            </div>
            <div class="form-group">
                <label>College End Time: <input type="time" id="endTime" value="17:00" required></label>
            </div>
            <div class="form-group">
                <label>Number of Periods: <input type="number" id="numPeriods" min="1" value="8" required></label>
            </div>
            <div class="form-group">
                <label>Duration (minutes): <input type="number" id="periodDuration" min="30" value="45" required></label>
            </div>
        </div>

        <div class="form-section">
            <h2>Breaks</h2>
            <div id="breaksContainer">
                <div class="break-row">
                    <input type="text" placeholder="Break Name" value="Lunch">
                    <input type="time" value="12:00">
                    <input type="number" placeholder="Duration (min)" value="45" min="5">
                    <button type="button" class="btn btn-remove" onclick="removeBreak(this)">Remove</button>
                </div>
            </div>
            <button type="button" class="btn btn-add" onclick="addBreak()">+ Add Break</button>
        </div>
        <div class="form-section">
            <h2>Academic Year/Semester</h2>
            <div class="form-group">
                <label>From Year/Semester:
                    <select id="fromGrade">
                        <option value="1">1st Year</option>
                        <option value="2">2nd Year</option>
                        <option value="3">3rd Year</option>
                        <option value="4">4th Year</option>
                        <option value="5">5th Year</option>
                    </select>
                </label>
                <label>To Year/Semester:
                    <select id="toGrade">
                        <option value="5">5th Year</option>
                        <option value="4">4th Year</option>
                        <option value="3">3rd Year</option>
                        <option value="2">2nd Year</option>
                        <option value="1">1st Year</option>
                    </select>
                </label>
            </div>
        </div>

        <div class="form-section">
            <h2>Courses & Subjects</h2>
            <div id="subjectsContainer">
                <div class="subject-row">
                    <input type="text" placeholder="Course Code" value="CS101" required>
                    <input type="text" placeholder="Course Name" value="Introduction to Programming" required>
                    <select class="class-type">
                        <option value="lecture">Lecture</option>
                        <option value="lab">Lab</option>
                        <option value="tutorial">Tutorial</option>
                        <option value="seminar">Seminar</option>
                        <option value="workshop">Workshop</option>
                    </select>
                    <input type="number" class="credits-input" placeholder="Credits" value="3" min="1" max="6" required>
                    <select>
                        <option value="1">1 - Highest Priority</option>
                        <option value="2">2 - High Priority</option>
                        <option value="3" selected>3 - Medium Priority</option>
                        <option value="4">4 - Low Priority</option>
                        <option value="5">5 - Lowest Priority</option>
                    </select>
                    <button type="button" class="btn btn-remove" onclick="removeSubject(this)">Remove</button>
                </div>
                <div class="subject-row">
                    <input type="text" placeholder="Course Code" value="MATH201" required>
                    <input type="text" placeholder="Course Name" value="Linear Algebra" required>
                    <select class="class-type">
                        <option value="lecture">Lecture</option>
                        <option value="lab" selected>Lab</option>
                        <option value="tutorial">Tutorial</option>
                        <option value="seminar">Seminar</option>
                        <option value="workshop">Workshop</option>
                    </select>
                    <input type="number" class="credits-input" placeholder="Credits" value="4" min="1" max="6" required>
                    <select>
                        <option value="1">1 - Highest Priority</option>
                        <option value="2">2 - High Priority</option>
                        <option value="3" selected>3 - Medium Priority</option>
                        <option value="4">4 - Low Priority</option>
                        <option value="5">5 - Lowest Priority</option>
                    </select>
                    <button type="button" class="btn btn-remove" onclick="removeSubject(this)">Remove</button>
                </div>
            </div>
            <button type="button" class="btn btn-add" onclick="addSubject()">+ Add Subject</button>
        </div>

        <div class="form-section">
            <h2>Teachers</h2>
            <div id="teachersContainer">
                <div class="teacher-row">
                    <input type="text" placeholder="Teacher Name" required>
                    <input type="text" placeholder="Subject" required>
                    <button type="button" class="btn btn-remove" onclick="removeTeacher(this)">Remove</button>
                </div>
            </div>
            <button type="button" class="btn btn-add" onclick="addTeacher()">+ Add Teacher</button>
        </div>

        <div class="form-group" style="display: flex; gap: 10px;">
            <button type="button" id="load-sample" class="btn" style="padding: 10px 20px; font-size: 16px; background-color: #6c757d;">Load Sample Data</button>
            <button type="button" id="generate-timetable" class="btn" style="padding: 10px 20px; font-size: 16px;">Generate Timetable</button>
        </div>
    </form>

    <div id="loading" style="display: none; margin: 20px 0;">Generating timetable, please wait...</div>
    <div id="error" class="error"></div>
    <div id="timetable"></div>

    <script>
        // Form management functions
        function addBreak() {
            const container = document.getElementById('breaksContainer');
            const breakRow = document.createElement('div');
            breakRow.className = 'break-row';
            breakRow.innerHTML = `
                <input type="text" placeholder="Break Name" required>
                <input type="time" value="10:30" required>
                <input type="number" placeholder="Duration (min)" value="15" min="5" required>
                <button type="button" class="btn btn-remove" onclick="removeBreak(this)">Remove</button>
            `;
            container.appendChild(breakRow);
        }

        function removeBreak(button) {
            if (document.querySelectorAll('.break-row').length > 1) {
                button.closest('.break-row').remove();
            } else {
                alert('At least one break is required');
            }
        }

        function addSubject() {
            const container = document.getElementById('subjectsContainer');
            const subjectRow = document.createElement('div');
            subjectRow.className = 'subject-row';
            subjectRow.innerHTML = `
                <input type="text" placeholder="Course Code" required>
                <input type="text" placeholder="Course Name" required>
                <select class="class-type">
                    <option value="lecture">Lecture</option>
                    <option value="lab">Lab</option>
                    <option value="tutorial">Tutorial</option>
                    <option value="seminar">Seminar</option>
                    <option value="workshop">Workshop</option>
                </select>
                <input type="number" class="credits-input" placeholder="Credits" value="3" min="1" max="6" required>
                <select>
                    <option value="1">1 - Highest Priority</option>
                    <option value="2">2 - High Priority</option>
                    <option value="3" selected>3 - Medium Priority</option>
                    <option value="4">4 - Low Priority</option>
                    <option value="5">5 - Lowest Priority</option>
                </select>
                <button type="button" class="btn btn-remove" onclick="removeSubject(this)">Remove</button>
            `;
            container.appendChild(subjectRow);
        }

        function removeSubject(button) {
            if (document.querySelectorAll('.subject-row').length > 1) {
                button.closest('.subject-row').remove();
            } else {
                alert('At least one subject is required');
            }
        }

        function addTeacher() {
            const container = document.getElementById('teachersContainer');
            const teacherRow = document.createElement('div');
            teacherRow.className = 'teacher-row';
            teacherRow.innerHTML = `
                <input type="text" placeholder="Teacher Name" required>
                <input type="text" placeholder="Subject" required>
                <button type="button" class="btn btn-remove" onclick="removeTeacher(this)">Remove</button>
            `;
            container.appendChild(teacherRow);
        }

        function removeTeacher(button) {
            button.closest('.teacher-row').remove();
        }

        // Function to create the prompt for timetable generation
        function createTimetablePrompt() {
            // Get college information
            const startTime = document.getElementById('startTime').value;
            const endTime = document.getElementById('endTime').value;
            const numPeriods = document.getElementById('numPeriods').value;
            const periodDuration = document.getElementById('periodDuration').value;
            const fromSemester = document.getElementById('fromGrade').value;
            const toSemester = document.getElementById('toGrade').value;

            // Map year values to display names
            const yearNames = {
                '1': '1st Year',
                '2': '2nd Year',
                '3': '3rd Year',
                '4': '4th Year',
                '5': '5th Year'
            };
            
            // Get course and branch information if available
            const courseName = document.getElementById('courseName')?.value || 'BTech';
            const branchName = document.getElementById('branchName')?.value || 'CSE';

            // Get breaks
            const breaks = [];
            document.querySelectorAll('.break-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                breaks.push({
                    name: inputs[0].value,
                    time: inputs[1].value,
                    duration: inputs[2].value
                });
            });

            // Get courses with details
            const courses = [];
            document.querySelectorAll('.subject-row').forEach(row => {
                const inputs = row.querySelectorAll('input, select');
                courses.push({
                    code: inputs[0].value,
                    name: inputs[1].value,
                    type: inputs[2].value,
                    credits: inputs[3].value,
                    priority: inputs[4].value
                });
            });

            // Get faculty
            const faculty = [];
            document.querySelectorAll('.teacher-row').forEach(row => {
                const inputs = row.querySelectorAll('input');
                faculty.push({
                    name: inputs[0].value,
                    subject: inputs[1].value
                });
            });

            // Sort courses by priority
            const sortedCourses = [...courses].sort((a, b) => parseInt(a.priority) - parseInt(b.priority));

            // Build the prompt
            let prompt = `Create a detailed college timetable for ${yearNames[fromSemester]} to ${yearNames[toSemester]} ${courseName} ${branchName} with the following specifications. 
IMPORTANT: Return ONLY the HTML table with proper styling, no explanations, notes, or additional text.

TEACHER LOAD MANAGEMENT:
1. Maximum 4 teaching hours per day per teacher in same class
2. No more than 2 consecutive hours of teaching without a break
3. Prefer morning hours for theory classes and afternoon for labs
4. Distribute teaching load evenly among all faculty members

STUDENT LOAD MANAGEMENT:
1. Maximum 6 hours of classes per day
2. No more than 3 consecutive hours without a break
3. Balance heavy and light subjects throughout the week
4. Avoid scheduling multiple lab sessions on the same day
5. Include at least one free period per day when possible

CLASS IDENTIFICATION:
1. Each timetable must have a clear heading with:
   - Year (e.g., "3rd Year")
   - Course Name (e.g., "BTech")
   - Branch (e.g., "CSE")
   - Section (e.g., "Section A")
   - Example: "3rd Year BTech CSE - Section A"
2. Include the class name in the title of each table
3. Add a small header above each day's schedule showing the class name

COLLEGE SCHEDULE:
- College Hours: ${startTime} to ${endTime}
- Number of Periods: ${numPeriods}
- Period Duration: ${periodDuration} minutes
- Days: Monday to Saturday (include Saturday for labs and practicals)

BREAKS:
`;
            
            breaks.forEach(b => {
                prompt += `- ${b.name}: ${b.time} (${b.duration} minutes)\n`;
            });

            prompt += `\nCOURSES (in priority order):\n`;
            sortedCourses.forEach((course, index) => {
                prompt += `${index + 1}. ${course.code} - ${course.name} (${course.credits} credits, ${course.type})\n`;
            });

            if (faculty.length > 0) {
                prompt += `\nFACULTY ASSIGNMENTS:\n`;
                faculty.forEach(prof => {
                    prompt += `- ${prof.name} (${prof.subject})\n`;
                });
            }

            prompt += `
TIMETABLE REQUIREMENTS:
1. Create a separate HTML table for each year
2. Each table should have a clear heading with the year, course, and branch (e.g., "3rd Year BTech CSE - Section A")
3. Include time slots, periods, and days of the week
4. Schedule breaks at their specified times
5. Respect course types (lectures, labs, tutorials, etc.)
6. Labs and practicals should be scheduled in appropriate time blocks (typically 2-3 hours)
7. Ensure faculty availability is respected (no double-booking)
8. Include faculty names and course codes in the schedule
9. Use a clean, professional table format with proper styling
10. Make sure the schedule fits within the college hours
11. Distribute courses evenly throughout the week
12. Consider student workload when scheduling multiple courses on the same day
13. Include room/venue information if available
14. Highlight lab sessions and tutorials with different background colors
15. Ensure there is sufficient time between classes for students to move between buildings

FORMAT REQUIREMENTS:
- Use HTML tables with proper semantic structure
- Include table headers for days and time slots
- Use appropriate column spans for multi-period sessions
- Include a legend explaining any color coding or special formatting
- Ensure the timetable is mobile-responsive
- Include CSS styling within <style> tags
- Make the tables responsive
- Use appropriate colors and spacing for readability
- Include proper table headers
- Ensure the timetable is well-organized and easy to read`;

            return prompt;
        }

        function showError(message) {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
        }

        function clearError() {
            const errorDiv = document.getElementById('error');
            errorDiv.textContent = '';
            errorDiv.style.display = 'none';
        }

        function setLoading(isLoading) {
            const button = document.getElementById('generate-timetable');
            const loadingDiv = document.getElementById('loading');
            if (isLoading) {
                button.disabled = true;
                loadingDiv.style.display = 'block';
            } else {
                button.disabled = false;
                loadingDiv.style.display = 'none';
            }
        }

        function extractHtmlFromResponse(responseText) {
            try {
                // First, try to extract just the timetable HTML
                const htmlMatch = responseText.match(/<table[\s\S]*?<\/table>/gi);
                if (htmlMatch && htmlMatch.length > 0) {
                    // Combine all tables with some spacing between them
                    return htmlMatch.join('\n<br>\n');
                }
                
                // If no tables found, try to find any HTML content
                const anyHtml = responseText.match(/<[^>]+>/);
                if (anyHtml) {
                    // If HTML tags found but no tables, return the whole response
                    return responseText;
                }
                
                // If no HTML at all, wrap in pre tags to preserve formatting
                return `<pre>${responseText}</pre>`;
            } catch (e) {
                console.error('Error parsing response:', e);
                return '<div class="error">Error: Could not format the timetable. Please try again.</div>';
            }
        }

        // Function to load sample data
        function loadSampleData() {
            try {
                // College Information
                document.getElementById('startTime').value = '09:00';
                document.getElementById('endTime').value = '17:00';
                document.getElementById('numPeriods').value = '8';
                document.getElementById('periodDuration').value = '60';
                document.getElementById('fromGrade').value = '1';
                document.getElementById('toGrade').value = '4';

                // Clear existing breaks, subjects, and teachers
                const breaksContainer = document.getElementById('breaksContainer');
                const subjectsContainer = document.getElementById('subjectsContainer');
                const teachersContainer = document.getElementById('teachersContainer');
                
                // Clear all containers
                if (breaksContainer) breaksContainer.innerHTML = '';
                if (subjectsContainer) subjectsContainer.innerHTML = '';
                if (teachersContainer) teachersContainer.innerHTML = '';
                
                // Add sample breaks
                const sampleBreaks = [
                    { name: 'Morning Break', time: '10:30', duration: '15' },
                    { name: 'Lunch', time: '12:45', duration: '45' }
                ];
                
                sampleBreaks.forEach((brk, index) => {
                    addBreak();
                    const rows = breaksContainer.getElementsByClassName('break-row');
                    const currentRow = rows[rows.length - 1];
                    const inputs = currentRow.querySelectorAll('input');
                    if (inputs.length >= 3) {
                        inputs[0].value = brk.name;
                        inputs[1].value = brk.time;
                        inputs[2].value = brk.duration;
                    }
                });

                // Add sample courses
                const sampleCourses = [
                    { code: 'CS201', name: 'Data Structures', type: 'lecture', credits: '4', priority: '1' },
                    { code: 'CS201L', name: 'Data Structures Lab', type: 'lab', credits: '2', priority: '1' },
                    { code: 'MATH301', name: 'Discrete Mathematics', type: 'lecture', credits: '4', priority: '2' },
                    { code: 'CS202', name: 'Computer Organization', type: 'lecture', credits: '3', priority: '2' },
                    { code: 'CS203', name: 'Database Systems', type: 'lecture', credits: '4', priority: '1' },
                    { code: 'CS203L', name: 'Database Lab', type: 'lab', credits: '2', priority: '1' },
                    { code: 'MATH302', name: 'Probability & Statistics', type: 'lecture', credits: '3', priority: '3' },
                    { code: 'HUM101', name: 'Professional Communication', type: 'lecture', credits: '2', priority: '4' }
                ];

                // First, ensure we have at least one subject row
                if (sampleCourses.length > 0) {
                    // Update the first row (already added by default)
                    const firstRow = subjectsContainer.querySelector('.subject-row');
                    if (firstRow) {
                        const inputs = firstRow.querySelectorAll('input, select');
                        if (inputs.length >= 5) {
                            inputs[0].value = sampleCourses[0].code;
                            inputs[1].value = sampleCourses[0].name;
                            const typeSelect = firstRow.querySelector('.class-type');
                            if (typeSelect) typeSelect.value = sampleCourses[0].type;
                            if (inputs[3]) inputs[3].value = sampleCourses[0].credits;
                            if (inputs[4]) inputs[4].value = sampleCourses[0].priority;
                        }
                    }
                    
                    // Add additional courses if any
                    for (let i = 1; i < sampleCourses.length; i++) {
                        addSubject();
                        const rows = subjectsContainer.getElementsByClassName('subject-row');
                        const currentRow = rows[rows.length - 1];
                        if (!currentRow) continue;
                        
                        const inputs = currentRow.querySelectorAll('input, select');
                        if (inputs.length >= 5) {
                            inputs[0].value = sampleCourses[i].code;
                            inputs[1].value = sampleCourses[i].name;
                            const typeSelect = currentRow.querySelector('.class-type');
                            if (typeSelect) typeSelect.value = sampleCourses[i].type;
                            if (inputs[3]) inputs[3].value = sampleCourses[i].credits;
                            if (inputs[4]) inputs[4].value = sampleCourses[i].priority;
                        }
                    }
                }

                // Add sample faculty
                const sampleFaculty = [
                    { name: 'Dr. Sarah Johnson', subject: 'CS201, CS201L' },
                    { name: 'Dr. Michael Chen', subject: 'MATH301, MATH302' },
                    { name: 'Prof. Robert Williams', subject: 'CS202' },
                    { name: 'Dr. Emily Rodriguez', subject: 'CS203, CS203L' },
                    { name: 'Prof. James Wilson', subject: 'HUM101' },
                    { name: 'Dr. Priya Patel', subject: 'CS201L, CS203L' },
                    { name: 'Prof. David Kim', subject: 'CS202, CS203' }
                ];

                // First, ensure we have at least one teacher row
                if (sampleFaculty.length > 0) {
                    // Update the first row (already added by default)
                    const firstRow = teachersContainer.querySelector('.teacher-row');
                    if (firstRow) {
                        const inputs = firstRow.querySelectorAll('input');
                        if (inputs.length >= 2) {
                            inputs[0].value = sampleFaculty[0].name;
                            inputs[1].value = sampleFaculty[0].subject;
                        }
                    }
                    
                    // Add additional teachers if any
                    for (let i = 1; i < sampleFaculty.length; i++) {
                        addTeacher();
                        const rows = teachersContainer.getElementsByClassName('teacher-row');
                        const currentRow = rows[rows.length - 1];
                        if (!currentRow) continue;
                        
                        const inputs = currentRow.querySelectorAll('input');
                        if (inputs.length >= 2) {
                            inputs[0].value = sampleFaculty[i].name;
                            inputs[1].value = sampleFaculty[i].subject;
                        }
                    }
                }

                // Scroll to top
                window.scrollTo(0, 0);
                alert('Sample data loaded successfully! Click "Generate Timetable" to see the results.');
            } catch (error) {
                console.error('Error loading sample data:', error);
                alert('Error loading sample data. Please check the console for details.');
            }
        }

        // Initialize the form with event listeners
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById('generate-timetable').addEventListener('click', generateTimetableWithGemini);
            document.getElementById('load-sample').addEventListener('click', loadSampleData);
            
            // Add initial break, subject, and teacher rows
            if (document.querySelectorAll('.break-row').length === 0) addBreak();
            if (document.querySelectorAll('.subject-row').length === 0) addSubject();
            if (document.querySelectorAll('.teacher-row').length === 0) addTeacher();
        });

        async function generateTimetableWithGemini() {
            const timetableDiv = document.getElementById('timetable');
            clearError();
            
            // Validate form
            const form = document.getElementById('timetableForm');
            if (!form.checkValidity()) {
                form.reportValidity();
                return;
            }

            setLoading(true);
            
            try {
                const response = await fetch('https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent?key=AIzaSyDngCLbCY_djpB0xWU3QbF_rx3tNK3wSqE', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: createTimetablePrompt()
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    const errorData = await response.json().catch(() => ({}));
                    throw new Error(errorData.error?.message || 'Failed to generate timetable');
                }
                
                const data = await response.json();
                const generatedContent = data.candidates?.[0]?.content?.parts?.[0]?.text;
                
                if (!generatedContent) {
                    throw new Error('No content received from the API');
                }
                
                // Try to extract HTML table from the response
                const htmlContent = extractHtmlFromResponse(generatedContent);
                timetableDiv.innerHTML = htmlContent;
                
            } catch (error) {
                console.error('Error generating timetable:', error);
                showError(`Error: ${error.message}. Please try again later.`);
                timetableDiv.innerHTML = '';
            } finally {
                setLoading(false);
            }
        }
    </script>
</body>
</html>
